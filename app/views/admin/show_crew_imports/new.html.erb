<%= render('shared/quick_actions_card') do %>
  <%= link_to "Back to #{@event.name}", admin_show_path(@event), class: "btn btn-secondary" %>
<% end %>

<div class="row">
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Option 1: Paste Data</h5>
      </div>
      <div class="card-body">
        <%= form_with url: preview_admin_show_show_crew_imports_path(@event), method: :post, local: true do |f| %>
          <p class="text-muted">Paste tab-separated data from Excel/spreadsheet. Expected columns:</p>
          <span class="font-monospace d-block mb-3">Name | Student ID (optional) | Email (optional) | Position</span>

          <%= f.text_area :paste_data, rows: 15, class: "form-control font-monospace",
              placeholder: "Name\tStudent ID\tEmail\tPosition\nFinbar the Viking\ts1234567\tfinbar@viking.se\tDirector\nErik Bloodaxe\t\terik@norse.no\tProducer" %>

          <div class="mt-3">
            <%= f.submit "Preview Import", class: "btn btn-primary" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Option 2: Upload XLSX</h5>
      </div>
      <div class="card-body">
        <%= form_with url: preview_admin_show_show_crew_imports_path(@event), method: :post, local: true, multipart: true do |f| %>
          <p class="text-muted">Upload an Excel file (.xlsx) with the same column structure.</p>

          <div class="mb-3">
            <%= f.file_field :xlsx_file, accept: ".xlsx", class: "form-control" %>
          </div>

          <div class="mt-3">
            <%= f.submit "Preview Import", class: "btn btn-primary" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<div class="card mt-4">
  <div class="card-header">
    <h5 class="mb-0">How It Works</h5>
  </div>
  <div class="card-body">
    <p>The import process matches each row against existing users and adds them to <strong><%= @event.name %></strong>:</p>
    <ol>
      <li><strong>Student/Associate ID match:</strong> If a user with the same ID exists, they will be added to the crew</li>
      <li><strong>Email match:</strong> If a user with the same email exists, they will be added to the crew</li>
      <li><strong>Name match:</strong> If an <em>active</em> user with the same last name and similar first name exists, you'll be asked to confirm</li>
      <li><strong>No match:</strong> A new user account will be created and added to the crew</li>
    </ol>
    <p class="text-muted">
      <strong>Note:</strong> If a student ID is provided but no email, the email will be auto-generated as <span class="font-monospace">&lt;student_id&gt;@ed.ac.uk</span>.
    </p>
    <p class="mb-0 text-muted">
      <strong>Existing team members:</strong> If someone is already on this show's team, you can choose to skip them, merge positions (combine old + new), or replace their position.
    </p>
  </div>
</div>
